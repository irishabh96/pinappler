var _ = require('lodash');

/*
    Individual Image object - core of the Fetch Image Logic
 */
var Image = require("../libs/image");

/*
    For the upload image logic
 */
var Upload = require("../libs/upload");

/*
    Main Constructor
 */
function ImageKit(options) {
    var self = this;

    //all globals initalized based on defaults or the user options
    self.globals = _.extend(getDefaults(), options);
    if(!verify(self.globals)) {
        throw(new Error("ImageKit Id, API Key and API secret are necessary for initialization."));
        return;
    }

    /*
        For generating image URLs for fetching the image
     */
    self.image = function(key, options) {
        var img = Image(key, options, self.globals);
        return img;
    };

    /*
        For uploading the images to your imagekit account
     */
    self.upload = function(image, options) {
        return new Upload(image, options, self.globals);
    };
};

function verify(globals) {
    if(!globals['imagekitId']
    || !globals['apiKey']
    || !globals['apiSecret']) {
        return false;
    }

    return true;
}

function getDefaults() {
    return {
        "imagekitId" : "",
        "apiKey" : "",
        "apiSecret" : "",
        "useSubdomain" : false,
        "useSecure" : false
    };
}

module.exports = ImageKit;