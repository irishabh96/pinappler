var path = require("path");
var crypto = require('crypto');

var CONSTANTS = require("./constants");

module.exports.getHost = function(imagekitId, useSubdomain) {
    if(!useSubdomain) {
        return CONSTANTS.COMMON_GET_SUBDOMAIN + CONSTANTS.BASE_GET;
    } else {
        return imagekitId + CONSTANTS.BASE_GET;
    }
};

module.exports.getProtocol = function(useSecure) {
    return (useSecure ? CONSTANTS.HTTPS_PROTOCOL : CONSTANTS.HTTP_PROTOCOL);
};

module.exports.getImageUploadURL = function(imagekitId) {
    return path.join(CONSTANTS.BASE_UPLOAD, CONSTANTS.UPLOAD_URL, imagekitId);
};

module.exports.calculateSignature = function(options) {
    var message = [], strSplit = [];
    message.push({
        "key" : "filename",
        "value" : options.filename
    }, {
        "key" : "timestamp",
        "value" : options.timestamp
    }, {
        "key" : "apiKey",
        "value" : options.apiKey
    });

    message.sort(function(a, b){
        return a.key > b.key;
    });
    
    for(var i in message) {
        strSplit.push(message[i]["key"]+"="+message[i]["value"]);
    }

    return crypto.createHmac('sha1', options.apiSecret).update(strSplit.join("&")).digest('hex');
};

module.exports.getInifiniteExpiry = function() {
    return CONSTANTS.INFINITE_EXPIRY_TIME;
}